<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Faça login</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
  <!-- MARCAÇÃO DO FORMULÁRIO -->
  <div class="container d-flex justify-content-center align-items-center" style="height:100vh">
    <div class="card p-4" style="max-width:400px; width:100%;">
      <h3 class="text-center mb-4">Faça login</h3>
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input id="email" type="email" class="form-control" autocomplete="username"/>
      </div>
      <div class="mb-3">
        <label for="senha" class="form-label">Senha</label>
        <input id="senha" type="password" class="form-control" autocomplete="current-password"/>
      </div>
      <button id="btnLogin" type="button" class="btn btn-primary w-100">Entrar</button>
      <div class="mt-3 text-center">
        <a href="cadastro.html">Ainda não tem conta? Cadastre-se</a>
      </div>
    </div>
  </div>

  <!-- 1) Injeção das variáveis -->
  <script>
    window.__SUPA_URL__ = "https://mumtrlalzcaskkssdryq.supabase.co";
    window.__SUPA_KEY__ = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11bXRybGFsemNhc2trc3NkcnlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk3NDY1MzMsImV4cCI6MjA2NTMyMjUzM30._TD5dWrbUox8kToC13MCDkgVlN6-7Zk76p4PjuOXMfw";
  </script>
  <!-- 2) SDK do Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <!-- 3) Lógica de login, só depois de tudo existir -->
  <script>
    // Aguarda DOM carregado
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('btnLogin');
      console.log('Listener será adicionado ao botão:', btn); // DEBUG

      // Se ainda for null, o HTML não foi atualizado corretamente
      if (!btn) return console.error('btnLogin não encontrado!');

      // Inicializa Supabase
      const supabaseClient = supabase.createClient(window.__SUPA_URL__, window.__SUPA_KEY__);

      btn.addEventListener('click', async () => {
        console.log('Botão clicado!'); // DEBUG
        const email = document.getElementById('email').value.trim();
        const senha = document.getElementById('senha').value.trim();
        if (!email || !senha) return alert('Digite seu email e senha.');
        const { data: user, error } = await supabaseClient.auth.signIn({ email, password: senha });
        if (error) return alert(error.message);
        localStorage.setItem('usuario', JSON.stringify({
          id: user.id,
          email: user.email,
          nivel: user.user_metadata.role || 'user'
        }));
        window.location.href = user.user_metadata.role === 'admin'
          ? 'dashboard.html'
          : 'responder-formulario.html';
      });
    });
  </script>
</body>
</html>
